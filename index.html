<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SUNBLANK｜memories</title>
<link rel="stylesheet" href="css/common.css">
</head>
<body>

<header>
  <h1>SUNBLANK｜memories</h1>
</header>
<nav>
  <ul>
    <li><a href="album/index.html">アルバム</a></li>
    <li><a href="comment/index.html">コメント</a></li>
    <li><a href="request/index.html">リクエスト</a></li>
  </ul>
</nav>

<main class="container">

  <!-- ▼ 旅の計画 -->
  <h2 class="section-title">旅の計画</h2>
  <section class="events">
    <a href="kusatsu2026/index.html" class="event">
      <img src="kusatsu2026/thumb.jpg" alt="草津温泉">
      <span>草津温泉旅行（案）</span>
    </a>
    <a href="arima2026/index.html" class="event">
      <img src="arima2026/thumb.jpg" alt="有馬温泉">
      <span>有馬温泉旅行（案）</span>
    </a>
    <a href="katsunuma2026/index.html" class="event">
      <img src="katsunuma2026/thumb.jpg" alt="ぶどうの丘">
      <span>山梨県勝沼市ぶどうの丘旅（案）</span>
    </a>
  </section>

  <!-- ▼ コンテンツ -->
  <h2 class="section-title">コンテンツ</h2>
  <section class="grid-2-1-2">
    <!-- 左：アルバムカード -->
    <a href="album/index.html" class="card-large album">
      <img src="images/album-thumb.jpg" alt="アルバム">
      <p>思い出アルバム</p>
    </a>

    <!-- 右：リクエスト掲示板 -->
    <div class="card-large request">
      <p class="board-title">リクエスト掲示板</p>
      <section class="request-board" id="requests-list"></section>
    </div>
  </section>

  <!-- ▼ 投稿ボタン -->
  <section class="grid-2">
    <a href="comment/index.html" class="card-small">
      <p>思い出を投稿</p>
    </a>
    <a href="request/index.html" class="card-small">
      <p>リクエストを投稿</p>
    </a>
  </section>

</main>

<script type="module">
  // Firebase SDKの読み込み
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, updateDoc, doc, serverTimestamp } 
    from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // Firebase設定（既存の設定を流用）
  const firebaseConfig = {
  apiKey: "AIzaSyAMynBwvGhlGbEi6UCHrZjYHNedf9pqXJQ",
  authDomain: "sunblank-memories.firebaseapp.com",
  projectId: "sunblank-memories",
  storageBucket: "sunblank-memories.appspot.com", // ←ここを修正
  messagingSenderId: "916551819188",
  appId: "1:916551819188:web:741bfd8c4534b511e35ce1"
};

  // 初期化
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // ▼ リクエスト一覧のリアルタイム表示
  const requestsList = document.getElementById("requests-list");
  const q = query(collection(db, "requests"), orderBy("createdAt", "desc"));

  onSnapshot(q, (snapshot) => {
    requestsList.innerHTML = "";
    snapshot.forEach((docSnap) => {
      const data = docSnap.data();
      const card = document.createElement("div");
      card.className = "card";

      card.innerHTML = `
        <p><strong>${data.name}</strong>：${data.text}</p>
        <p>状態：${data.status || "考え中…"}</p>
        <div class="status-buttons">
          <button onclick="updateStatus('${docSnap.id}','叶った！')">叶った！</button>
          <button onclick="updateStatus('${docSnap.id}','準備中！')">準備中！</button>
          <button onclick="updateStatus('${docSnap.id}','考え中…')">考え中…</button>
          <button onclick="updateStatus('${docSnap.id}','また今度！')">また今度！</button>
        </div>
      `;
      requestsList.appendChild(card);
    });
  });

  // ▼ ステータス更新関数
  window.updateStatus = async (id, status) => {
    const ref = doc(db, "requests", id);
    await updateDoc(ref, { status });
  };

  // ▼ 投稿処理（必要ならフォームから呼び出し）
  window.addRequest = async (name, text) => {
    await addDoc(collection(db, "requests"), {
      name,
      text,
      createdAt: serverTimestamp(),
      status: "考え中…"
    });
  };
</script>

</body>
</html>